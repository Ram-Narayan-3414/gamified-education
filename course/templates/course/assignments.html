{% extends "course/base.html" %}

{% load i18n %}

{% block title %}
    {% trans 'Assignments' %}
{% endblock %}

{% block content %}
    {% if students_data != None %}
        <div id='student-dropdown-container'>
            <a class='dropdown-button btn grey lighten-3 grey-text text-darken-3' href='#students-dropdown' data-activates='students-dropdown'>
                {% trans 'Select Student' %}
            </a>
            <ul id='students-dropdown' class='dropdown-content'>
                {% for student_data in students_data %}
                    <li>
                        <a href="/{{course_class.course.code}}/{{course_class.code}}/assignments/{{student_data.id}}">
                            {{student_data.full_name}}
                        </a>
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% endif %}
        
    {% if assignment_items_data != None %}
        <header id='student-header' class='flow-text'>
            <i id='student-icon' class="material-icons circle orange">person</i>
            <div id='student-info'>
                <h1 id='student-name'>
                    {{enrollment.student.full_name}}
                </h1>
                <h2 id='student-total-score'>
                    {{enrollment.total_score}} XP
                </h2>
            </div>
        </header>
    
        <ul id='assignment-list'>
            {% for assignment_item in assignment_items_data %}
                <li class="assignment-list-item card">
                    <div class="card-content grey lighten-4">
                        <span class="assignment-name card-title activator grey-text text-darken-4">
                            {{assignment_item.name}}
                            <!-- <i class="material-icons right">more_vert</i> -->
                        </span>
                        <p class='assignment-description'>{{assignment_item.description}}</p> 
                    </div>
                    <div class="card-action">
                        <div class='assignment-score'>
                            {% if assignment_item.total_grade_percentage != None %}
                                <div class='assignment-min-max'>
                                    <small>0 XP</small>
                                    <small>{{assignment_item.total_task_points}} XP</small>
                                </div> 

                                <div class="progress">
                                    <div class="determinate" style="width: {{assignment_item.total_grade_percentage|safe}}%"></div>
                                </div>
                            {% endif %}

                            {% if assignment_item.total_grade_points != None %}
                                <h5 class='assignment-score-points xp-label'>
                                    {{assignment_item.total_grade_points}} XP

                                    {% if assignment_item.total_grade_percentage != None %}
                                        <a class='change-to-percentage' href='#assignment-list'>
                                            <i class="material-icons">swap_horiz</i>
                                        </a>
                                    {% endif %}
                                </h5>
                                {% if assignment_item.total_grade_percentage != None %}
                                    <h5 class='assignment-score-points percentage-label'>
                                        {{assignment_item.total_grade_percentage}} %
                                        <a class='change-to-xp' href='#!'>
                                            <i class="material-icons">swap_horiz</i>
                                        </a>
                                    </h5>
                                {% endif %}
                            {% else %}
                                <small class='assignment-no-points'>{% trans '(no points)' %}</small>
                            {% endif %}
                        </div>
                        
                        <ul class='task-list'>
                            {% for task in assignment_item.tasks %}
                                {% if task.grade_points != None or not task.is_optional %}
                                    <li class='task-list-item {% if task.grade_is_canceled or task.grade_points < 0 %}red-text{% endif %}'>
                                        {% if task.grade_is_canceled or task.grade_points < 0 %}
                                            <i class="material-icons circle-icon">remove_circle</i>
                                        {% elif task.grade_points == None %}
                                            <i class="material-icons no-grade-icon">lens</i>
                                        {% elif task.task_points == None %}
                                            <i class="material-icons circle-icon orange-text">
                                                add_circle
                                            </i>
                                        {% else %}
                                            <i class="material-icons orange-text">
                                                {% if task.grade_percentage == 100 %}
                                                    star
                                                {% elif task.grade_percentage >= 50 %}
                                                    star_half
                                                {% else %}
                                                    star_border
                                                {% endif %}
                                            </i>
                                        {% endif %}

                                        <span class='task-name truncate'>
                                            {{task.name}}
                                        </span>
                                        
                                        {% if task.grade_is_canceled %}
                                            <span class='task-points badge red-text'>{% trans 'CANCELED' %}</span>
                                        {% elif task.task_points == None %}
                                            {% if task.grade_points >= 0 %}
                                                <span class='task-points badge'>
                                                    +{{task.grade_points}} XP
                                                </span>
                                            {% elif task.grade_points < 0 %}
                                                <span class='task-points badge red-text'>
                                                    â€“{{ task.grade_points|stringformat:"+d"|slice:"1:" }} XP
                                                </span>
                                            {% endif %}
                                        {% elif task.grade_percentage != None %}
                                            <span class='task-points badge xp-label'>
                                                +{{task.grade_points}} XP
                                            </span>
                                            <span class='task-points badge percentage-label'>
                                                {{task.grade_percentage}} %
                                            </span>
                                        {% endif %}
                                    </li>
                                {% endif %}
                            {% endfor %}
                        </ul>
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% endif %}
{% endblock content %}